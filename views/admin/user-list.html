<!DOCTYPE html>
<!--
This is a starter template page. Use this page to start your new project from
scratch. This page gets rid of all links and provides the needed markup only.
-->
<html>
{{template "admin/html-head.html"}}
<!--
BODY TAG OPTIONS:
=================
Apply one or more of the following classes to get the
desired effect
|---------------------------------------------------------|
| SKINS         | skin-blue                               |
|               | skin-black                              |
|               | skin-purple                             |
|               | skin-yellow                             |
|               | skin-red                                |
|               | skin-green                              |
|---------------------------------------------------------|
|LAYOUT OPTIONS | fixed                                   |
|               | layout-boxed                            |
|               | layout-top-nav                          |
|               | sidebar-collapse                        |
|               | sidebar-mini                            |
|---------------------------------------------------------|
-->
<body class="hold-transition skin-blue sidebar-mini">
<div class="wrapper">

  <!-- Main Header -->
  {{template "admin/html-header.html"}}
  <!-- Left side column. contains the logo and sidebar -->
  {{template "admin/html-aside.html"}}

  <!-- Content Wrapper. Contains page content -->
  <div class="content-wrapper">
    <!-- Content Header (Page header) -->
    <section class="content-header">
      <h1>
        Data Tables
        <small>advanced tables</small>
      </h1>
      <ol class="breadcrumb">
        <li><a href="#"><i class="fa fa-dashboard"></i> Home</a></li>
        <li><a href="#">Tables</a></li>
        <li class="active">Data tables</li>
      </ol>
    </section>

    <!-- Main content -->
    <section class="content">
      <div class="row">
        <div class="col-xs-12">
          <div class="box">
            <div class="box-header">
              <h3 class="box-title">Data Table With Full Features</h3>
            </div>
            <!-- /.box-header -->
            <div class="box-body">
              <table id="userlist" class="table table-bordered table-striped">
                <thead>
                <tr>
                  <th>ID</th>
                  <th>name</th>
                  <th>gender</th>
                  <th>mobile</th>
                  <th>email</th>
                  <th>address</th>
                  <th>createdAt</th>
                  <th>updatedAt</th>
                  <th>操作</th>
                </tr>
                </thead>
                <tbody>
                {{range $index, $elem := .userList}}
                <tr data-id="{{$elem.Id}}">
                  <td>{{$elem.Id}}</td>
                  <td>{{$elem.Username}}</td>
                  <td>{{$elem.Gender}}</td>
                  <td>{{$elem.Mobile}}</td>
                  <td>{{$elem.Email}}</td>
                  <td>{{$elem.Addr}}</td>
                  <td>{{$elem.CreatedAt}}</td>
                  <td>{{$elem.UpdatedAt}}</td>
                  <td>
                    <button class="btn btn-primary J-update">update</button>
                    <button class="btn btn-danger J-delete">delete</button>
                  </td>
                </tr>
                {{end}}
                </tbody>
                <tfoot>
                <tr>
                  <th>ID</th>
                  <th>name</th>
                  <th>gender</th>
                  <th>mobile</th>
                  <th>email</th>
                  <th>address</th>
                  <th>createdAt</th>
                  <th>updatedAt</th>
                  <th>操作</th>
                </tr>
                </tfoot>
              </table>
            </div>
            <!-- /.box-body -->
          </div>
          <!-- /.box -->
        </div>
        <!-- /.col -->
      </div>
      <!-- /.row -->
    </section>
    <!-- /.content -->
  </div>
  <!-- /.content-wrapper -->

  <!-- Main Footer -->
  <footer class="main-footer">
    <!-- To the right -->
    <div class="pull-right hidden-xs">
      Anything you want
    </div>
    <!-- Default to the left -->
    <strong>Copyright &copy; 2016 <a href="#">Company</a>.</strong> All rights reserved.
  </footer>

  <!-- Control Sidebar -->
  <aside class="control-sidebar control-sidebar-dark">
    <!-- Create the tabs -->
    <ul class="nav nav-tabs nav-justified control-sidebar-tabs">
      <li class="active"><a href="#control-sidebar-home-tab" data-toggle="tab"><i class="fa fa-home"></i></a></li>
      <li><a href="#control-sidebar-settings-tab" data-toggle="tab"><i class="fa fa-gears"></i></a></li>
    </ul>
    <!-- Tab panes -->
    <div class="tab-content">
      <!-- Home tab content -->
      <div class="tab-pane active" id="control-sidebar-home-tab">
        <h3 class="control-sidebar-heading">Recent Activity</h3>
        <ul class="control-sidebar-menu">
          <li>
            <a href="javascript:;">
              <i class="menu-icon fa fa-birthday-cake bg-red"></i>

              <div class="menu-info">
                <h4 class="control-sidebar-subheading">Langdon's Birthday</h4>

                <p>Will be 23 on April 24th</p>
              </div>
            </a>
          </li>
        </ul>
        <!-- /.control-sidebar-menu -->

        <h3 class="control-sidebar-heading">Tasks Progress</h3>
        <ul class="control-sidebar-menu">
          <li>
            <a href="javascript:;">
              <h4 class="control-sidebar-subheading">
                Custom Template Design
                <span class="pull-right-container">
                    <span class="label label-danger pull-right">70%</span>
                  </span>
              </h4>

              <div class="progress progress-xxs">
                <div class="progress-bar progress-bar-danger" style="width: 70%"></div>
              </div>
            </a>
          </li>
        </ul>
        <!-- /.control-sidebar-menu -->

      </div>
      <!-- /.tab-pane -->
      <!-- Stats tab content -->
      <div class="tab-pane" id="control-sidebar-stats-tab">Stats Tab Content</div>
      <!-- /.tab-pane -->
      <!-- Settings tab content -->
      <div class="tab-pane" id="control-sidebar-settings-tab">
        <form method="post">
          <h3 class="control-sidebar-heading">General Settings</h3>

          <div class="form-group">
            <label class="control-sidebar-subheading">
              Report panel usage
              <input type="checkbox" class="pull-right" checked>
            </label>

            <p>
              Some information about this general settings option
            </p>
          </div>
          <!-- /.form-group -->
        </form>
      </div>
      <!-- /.tab-pane -->
    </div>
  </aside>
  <!-- /.control-sidebar -->
  <!-- Add the sidebar's background. This div must be placed
  immediately after the control sidebar -->
  <div class="control-sidebar-bg"></div>
</div>
<!-- ./wrapper -->

<!-- 弹窗内容-->
<div id="update-dialog" style="display: none;">
  <div class="col-md-6">
    <!-- general form elements -->
    <div class="box box-primary">
      <div class="box-header with-border">
        <h3 class="box-title">Quick Example</h3>
      </div>
      <!-- /.box-header -->
      <!-- form start -->
      <form role="form" method="post" onsubmit="return false">
        <div class="box-body">
          <div class="form-group">
            <label for="name">name</label>
            <input type="text" class="form-control" id="username" name="username" placeholder="username">
          </div>
          <div class="form-group">
            <label for="gender">gender</label>
            <select name="sex" class="form-control">
              <option value="0">女</option>
              <option value="1">男</option>
            </select>
          </div>
          <div class="form-group">
            <label for="mobile">mobile</label>
            <input type="text" class="form-control" id="mobile" name="mobile" placeholder="mobile">
          </div>
          <div class="form-group">
            <label for="email">email</label>
            <input type="text" class="form-control" id="email" name="email" placeholder="email">
          </div>
          <div class="form-group">
            <label for="address">address</label>
            <input type="text" class="form-control" id="address" name="addr" placeholder="addr">
          </div>
        </div>
        <!-- /.box-body -->
        <div class="box-footer">
          <input type="hidden" id="userId">
          <button type="submit" class="btn btn-primary J-submit">Submit</button>
        </div>
      </form>
    </div>
    <!-- /.box -->
  </div>
</div>
<!-- /弹窗内容-->

<!-- REQUIRED JS SCRIPTS -->

<!-- jQuery 3 -->
<script src="../../static/bower_components/jquery/dist/jquery.min.js"></script>
<!-- Bootstrap 3.3.7 -->
<script src="../../static/bower_components/bootstrap/dist/js/bootstrap.min.js"></script>
<!-- DataTables -->
<script src="../../static/bower_components/datatables.net/js/jquery.dataTables.min.js"></script>
<script src="../../static/bower_components/datatables.net-bs/js/dataTables.bootstrap.min.js"></script>
<!-- SlimScroll -->
<script src="../../static/bower_components/jquery-slimscroll/jquery.slimscroll.min.js"></script>
<!-- FastClick -->
<script src="../../static/bower_components/fastclick/lib/fastclick.js"></script>
<!-- AdminLTE App -->
<script src="../../static/dist/js/adminlte.min.js"></script>
<!-- AdminLTE for demo purposes -->
<script src="../../static/dist/js/demo.js"></script>
<!-- layer -->
<script src="../../static/plugins/layer/layer.js"></script>
<!-- page script -->
<script>
  $(function () {
    //列表
    $('#userlist').DataTable({
      'paging'      : true,
      'lengthChange': false,
      'searching'   : false,
      'ordering'    : true,
      'info'        : true,
      'autoWidth'   : false
    })
    //删除
    $("#userlist").on("click", ".J-delete", function() {
      var id=$(this).closest("tr").data("id");
      if (confirm("确定删除？")) {
        $.ajax({
          url:'/admin/user/delete',
          type:'post', //GET
          async:true,    //或false,是否异步
          data:{
            userId:id
          },
          timeout:5000,    //超时时间
          dataType:'json',    //返回的数据格式：json/xml/html/script/jsonp/text
          beforeSend:function(xhr){
            console.log(xhr)
            console.log('发送前')
          },
          success:function(data,textStatus,jqXHR){
            alert("删除成功！")
            location.reload();
          },
          error:function(xhr,textStatus){
            console.log('错误')
            console.log(xhr)
            console.log(textStatus)
          },
          complete:function(){
            console.log('结束')
          }
        })
      }
    });
    //修改
    $("#userlist").on("click", ".J-update", function() {
      var id=$(this).closest("tr").data("id");
      $.get("/admin/user/"+id, function(data) {
        $("#userId").val(id);
        $("#username").val(data.result.Username);
        $("#email").val(data.result.Email);
        $("#mobile").val(data.result.Mobile);
        $("#email").val(data.result.Email);
        $("#address").val(data.result.Addr);
        layer.open({
          type: 1,
          area: ['500px', 'auto'],
          shadeClose: true, //点击遮罩关闭
          content: $("#update-dialog")
        });
      })
    });
    
    //修改
    $("#update-dialog form").on("click", ".J-submit", function() {
      $.ajax({
        url:'/admin/user',
        type:'PUT', //GET
        async:true,    //或false,是否异步
        data:{
          userId: $("#userId").val(),
          username:$("#username").val(),
          email: $("#email").val(),
          mobile: $("#mobile").val(),
          email: $("#email").val(),
          addr: $("#address").val()
        },
        timeout:5000,    //超时时间
        dataType:'json',    //返回的数据格式：json/xml/html/script/jsonp/text
        beforeSend:function(xhr){
          
        },
        success:function(data,textStatus,jqXHR){
          layer.msg("修改成功！")
          location.reload();
        },
        error:function(xhr,textStatus){
          
        },
        complete:function(){
          
        }
      })
    })
  })
</script>
</body>
</html>